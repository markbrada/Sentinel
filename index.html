<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Support‑at‑Home Leads Dashboard</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QZ6WDaQZZr+AtlZg9p7++9M1u9R6JvccM4WprqbiMXp59S+gXxBnhLK8bzqom0nM" crossorigin="anonymous">
  <!-- DataTables + Bootstrap 5 skin -->
  <link href="https://cdn.datatables.net/1.13.8/css/dataTables.bootstrap5.min.css" rel="stylesheet">
  <style>
    body { background:#f8f9fb; font-family: "Helvetica Neue", Arial, sans-serif; }
    h1 { font-weight:600; }
    .stat‑card { min-width:200px; }
    .tab‑content { margin-top:1rem; }
    table.dataTable tbody tr:hover { background:#eef6ff; }
  </style>
</head>
<body>
<div class="container py-4">
  <h1 class="mb-4">Support‑at‑Home Leads Dashboard</h1>

  <!-- Headline stats  -->
  <div class="row g-3 mb-4" id="headlineStats">
    <div class="col-12 col-md-4">
      <div class="card stat‑card shadow-sm text-center">
        <div class="card-body">
          <h2 id="clientsCount" class="display-6">0</h2>
          <p class="mb-0">Potential Clients</p>
        </div>
      </div>
    </div>
    <div class="col-12 col-md-4">
      <div class="card stat‑card shadow-sm text-center">
        <div class="card-body">
          <h2 id="tendersCount" class="display-6">0</h2>
          <p class="mb-0">Tender Opportunities</p>
        </div>
      </div>
    </div>
    <div class="col-12 col-md-4">
      <div class="card stat‑card shadow-sm text-center">
        <div class="card-body">
          <h2 id="otCount" class="display-6">0</h2>
          <p class="mb-0">OT Practices</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <ul class="nav nav-tabs" id="leadsTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="clients-tab" data-bs-toggle="tab" data-bs-target="#clients" type="button" role="tab">Clients</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tenders-tab" data-bs-toggle="tab" data-bs-target="#tenders" type="button" role="tab">Tenders</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="ot-tab" data-bs-toggle="tab" data-bs-target="#ot" type="button" role="tab">OT Practices</button>
    </li>
  </ul>
  <div class="tab-content" id="leadsTabsContent">
    <div class="tab-pane fade show active" id="clients" role="tabpanel">
      <div class="table-responsive">
        <table id="clientsTable" class="table table-striped table-bordered w-100"></table>
      </div>
    </div>
    <div class="tab-pane fade" id="tenders" role="tabpanel">
      <div class="table-responsive">
        <table id="tendersTable" class="table table-striped table-bordered w-100"></table>
      </div>
    </div>
    <div class="tab-pane fade" id="ot" role="tabpanel">
      <div class="table-responsive">
        <table id="otTable" class="table table-striped table-bordered w-100"></table>
      </div>
    </div>
  </div>
</div>

<!-- jQuery, Bootstrap & DataTables JS -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-no0ev5LbphmBnT7F5JBLVvXH2zqu14WwfLVSv3Dpt+c8YmlnqsXehgHDPvFzpw5y" crossorigin="anonymous"></script>
<script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap5.min.js"></script>

<script>
(async function () {
  try {
    const resp = await fetch('data.json');
    if (!resp.ok) throw new Error('Unable to load data.json');
    const data = await resp.json();

    // Headline stats
    document.getElementById('clientsCount').textContent = data.NewPotentialClients?.length ?? 0;
    document.getElementById('tendersCount').textContent = data.TenderOpportunities?.length ?? 0;
    document.getElementById('otCount').textContent = data.OTPractices?.length ?? 0;

    // Helper ─ pick last URL as website, fallback blank
    const lastUrl = arr => Array.isArray(arr) && arr.length ? arr[arr.length - 1] : '';

    // Build Clients table rows (strip personal contact fields)
    const clientsRows = (data.NewPotentialClients || []).map(c => [
      c.ProviderName,
      c.Type,
      c.Region,
      c.EstimatedClientCount ?? '',
      c.DecisionMaker?.Phone ?? '',
      lastUrl(c.SourceURLs) ? `<a href="${lastUrl(c.SourceURLs)}" target="_blank">Website</a>` : ''
    ]);

    $('#clientsTable').DataTable({
      data: clientsRows,
      columns: [
        { title: 'Provider' },
        { title: 'Type' },
        { title: 'Region' },
        { title: 'Client Size' },
        { title: 'Phone' },
        { title: 'Website', orderable:false }
      ],
      pageLength: 25,
      lengthMenu: [ [25, 50, -1], [25, 50, 'All'] ],
      order: [[0, 'asc']],
      responsive: true
    });

    // Build Tenders table
    const tenderRows = (data.TenderOpportunities || []).map(t => [
      t.Title,
      t.Buyer,
      t.OpenDate,
      t.CloseDate,
      t.RelevanceCategory,
      `<a href="${t.TenderLink}" target="_blank">Link</a>`
    ]);

    $('#tendersTable').DataTable({
      data: tenderRows,
      columns: [
        { title: 'Title' },
        { title: 'Buyer' },
        { title: 'Open' },
        { title: 'Close' },
        { title: 'Category' },
        { title: 'Docs', orderable:false }
      ],
      pageLength: 25,
      order: [[2, 'desc']],
      responsive: true
    });

    // Build OT Practices table
    const otRows = (data.OTPractices || []).map(o => [
      o.PracticeName,
      o.Region,
      o.OTStaffCount,
      o.Contact?.Phone ?? '',
      o.Contact?.LinkedIn ? `<a href="${o.Contact.LinkedIn}" target="_blank">LinkedIn</a>` : ''
    ]);

    $('#otTable').DataTable({
      data: otRows,
      columns: [
        { title: 'Practice' },
        { title: 'Region' },
        { title: '# OTs' },
        { title: 'Phone' },
        { title: 'Profile', orderable:false }
      ],
      pageLength: 25,
      order: [[0, 'asc']],
      responsive: true
    });
  } catch (err) {
    console.error(err);
    alert('Failed to load or parse data.json — check console for details.');
  }
})();
</script>
</body>
</html>
